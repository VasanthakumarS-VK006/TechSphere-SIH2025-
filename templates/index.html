<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Autocomplete Search</title>
	<style>
		.autocomplete-container {
			margin: 50px;
			position: relative;
			width: 300px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		#search-input,
		#result-input {
			width: 100%;
			padding: 8px;
			font-size: 16px;
		}

		#suggestions,
		#result {
			position: absolute;
			top: 100%;
			width: 100%;
			border: 1px solid #ccc;
			max-height: 200px;
			overflow-y: auto;
			background: white;
			display: none;
			z-index: 10;
			/* Ensure dropdowns appear above other elements */
		}

		.suggestion-item,
		.result-item {
			padding: 8px;
			cursor: pointer;
		}

		.suggestion-item:hover,
		.result-item:hover {
			background-color: #f0f0f0;
		}

		#submit-button {
			margin: 10px 50px;
		}
	</style>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
		crossorigin="anonymous"></script>
</head>

<body>

	<div class="container-fluid p-5">
		<div class="row">
			<div class="col">

				<div class="autocomplete-container">
					<label for="search-input">
						<h3>NAMC Code: </h3>
					</label>
					<input type="text" id="search-input" placeholder="Search..." style="min-width: 350px;">
					<div id="suggestions" class="suggestions"></div>
				</div>

			</div>

			<div class="col-2 mt-5 pt-3">

				<button id="submit-button" disabled style="max-width: 100px; max-height: 50px;">Convert</button>
			</div>
			<div class="col">

				<div class="autocomplete-container">
					<label for="result-input">
						<h3>ICD Code: </h3>
					</label>
					<input type="text" id="result-input" placeholder="ICD..." style="min-width: 350px;">
					<div id="result" class="results"></div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// script.js
		const searchInput = document.getElementById('search-input');
		const suggestionsContainer = document.getElementById('suggestions');
		const submitButton = document.getElementById('submit-button');
		const resultInput = document.getElementById('result-input');
		const resultDiv = document.getElementById('result');

		let isSuggestionSelected = false; // Track if a suggestion was selected
		let isResultSelected = false; // Track if a suggestion was selected

		searchInput.addEventListener('input', async () => {
			const query = searchInput.value.trim();
			isSuggestionSelected = false; // Reset on new input
			submitButton.disabled = true; // Disable button until suggestion is selected

			if (query.length === 0) {
				suggestionsContainer.style.display = 'none';
				return;
			}

			try {
				const response = await fetch(`http://127.0.0.1:5000/api/suggestions?q=${encodeURIComponent(query)}`);
				if (!response.ok) throw new Error(`Network response was not ok: ${response.status}`);

				const suggestions = await response.json();
				console.log('Suggestions:', suggestions); // Debug

				suggestionsContainer.innerHTML = '';

				if (suggestions.length > 0) {
					suggestions.forEach(item => {
						const div = document.createElement('div');
						div.className = 'suggestion-item';
						div.textContent = item; // English term
						div.addEventListener('click', () => {
							searchInput.value = item; // Set input value
							suggestionsContainer.style.display = 'none';
							isSuggestionSelected = true; // Mark suggestion as selected
							submitButton.disabled = false; // Enable submit button
						});
						suggestionsContainer.appendChild(div);
					});
					suggestionsContainer.style.display = 'block';
				} else {
					suggestionsContainer.style.display = 'none';
				}
			} catch (error) {
				console.error('Error fetching suggestions:', error);
				suggestionsContainer.style.display = 'none';
			}
		});

		// Handle submit button click
		submitButton.addEventListener('click', async () => {
			if (!isSuggestionSelected) {
				resultDiv.innerHTML = '<p>Please select a suggestion from the list.</p>';
				return;
			}

			const selectedTerm = searchInput.value.trim();
			if (!selectedTerm) {
				resultDiv.innerHTML = '<p>No term selected.</p>';
				return;
			}

			try {
				const response = await fetch('http://127.0.0.1:5000/api/submit', {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({term: selectedTerm}),
				});
				if (!response.ok) throw new Error(`Submit failed: ${response.status}`);

				const result = await response.json();
				console.log('Submit API response:', result); // Debug




				if (result.length > 0) {
					result.forEach(item => {
						const di = document.createElement('div');
						di.className = 'result-item';
						di.textContent = item;
						di.addEventListener('click', () => {
							resultInput.value = item;
							isResultSelected = true;
							resultDiv.innerHTML = ''; // Clear previous results
						});
						resultDiv.appendChild(di);
					});
					resultDiv.style.display = 'block';
				} else {
					resultDiv.style.display = 'none';
				}





			} catch (error) {
				console.error('Error submitting term:', error);
				resultDiv.innerHTML = `<p>Error: ${error.message}</p>`;
			}
		});

		// Hide suggestions when clicking outside
		document.addEventListener('click', (e) => {
			if (!suggestionsContainer.contains(e.target) && e.target !== searchInput) {
				suggestionsContainer.style.display = 'none';
			}
		});
	</script>
</body>

</html>

</script>
</body>

</html>

</script>
</body>

</html>

</script>
</body>

</html>
